package com.example.floggy.config;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.reactive.function.client.WebClient;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;

@Configuration
public class VulnerabilityConfig {
    
    @Value("${vulnerability.nvd.api.url:https://services.nvd.nist.gov/rest/json/cves/2.0}")
    private String nvdApiUrl;
    
    @Value("${vulnerability.github.advisory.url:https://api.github.com/advisories}")
    private String githubAdvisoryUrl;
    
    @Value("${vulnerability.snyk.api.url:https://api.snyk.io/v1}")
    private String snykApiUrl;
    
    @Bean
    public WebClient nvdWebClient() {
        return WebClient.builder()
            .baseUrl(nvdApiUrl)
            .defaultHeader("Accept", "application/json")
            .build();
    }
    
    @Bean
    public WebClient githubAdvisoryWebClient() {
        return WebClient.builder()
            .baseUrl(githubAdvisoryUrl)
            .defaultHeader("Accept", "application/vnd.github+json")
            .build();
    }
    
    @Bean
    public WebClient snykWebClient() {
        return WebClient.builder()
            .baseUrl(snykApiUrl)
            .defaultHeader("Accept", "application/json")
            .build();
    }
    
    @Bean
    public ObjectMapper objectMapper() {
        ObjectMapper mapper = new ObjectMapper();
        mapper.registerModule(new JavaTimeModule());
        return mapper;
    }
    
    @Bean
    public WebClient.Builder webClientBuilder() {
        return WebClient.builder();
    }
}